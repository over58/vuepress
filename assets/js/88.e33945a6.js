(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{384:function(t,n,s){"use strict";s.r(n);var a=s(42),e=Object(a.a)({},(function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码"}},[t._v("#")]),t._v(" 代码")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("function Vue (options) {\n  if (process.env.NODE_ENV !== 'production' &&\n    !(this instanceof Vue)\n  ) {\n    warn('Vue is a constructor and should be called with the `new` keyword')\n  }\n  this._init(options)\n}\n\ninitMixin(Vue)\nstateMixin(Vue)\neventsMixin(Vue)\nlifecycleMixin(Vue)\nrenderMixin(Vue)\n\nexport default Vue\n")])])]),t._v(" "),s("h2",{attrs:{id:"主要步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主要步骤"}},[t._v("#")]),t._v(" 主要步骤")]),t._v(" "),s("p",[t._v("1.initMixin(Vue)\n2.stateMixin(Vue)\n3.eventsMixin(Vue)\n4.lifecycleMixin(Vue)\n5.renderMixin(Vue)")]),t._v(" "),s("h3",{attrs:{id:"initmixin-vue"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#initmixin-vue"}},[t._v("#")]),t._v(" initMixin(Vue)")]),t._v(" "),s("p",[t._v("添加了Vue.prototype._init()方法")]),t._v(" "),s("h3",{attrs:{id:"statemixin-vue"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#statemixin-vue"}},[t._v("#")]),t._v(" stateMixin(Vue)")]),t._v(" "),s("p",[t._v("添加了")]),t._v(" "),s("ul",[s("li",[t._v("Vue.prototype.$data")]),t._v(" "),s("li",[t._v("Vue.prototype.$props")]),t._v(" "),s("li",[t._v("Vue.prototype.$set(响应式更改，并通知)")]),t._v(" "),s("li",[t._v("Vue.prototype.$delete(响应式删除，并通知)")]),t._v(" "),s("li",[t._v("Vue.prototype.$watch")])]),t._v(" "),s("p",[t._v("并已经为$data和$props添加了set,get方法,执行如下")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(" Object.defineProperty(Vue.prototype, '$data', {\n    get () {\n      return this._data\n    },\n    set () {\n        warn(\n          'Avoid replacing instance root $data. ' +\n          'Use nested data properties instead.',\n          this\n        )\n     }\n })\n Object.defineProperty(Vue.prototype, '$props', {\n    get () {\n      return this._props\n    },\n    set () {\n      warn(`$props is readonly.`, this)\n    }\n})\n")])])]),s("h3",{attrs:{id:"eventsmixin-vue"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eventsmixin-vue"}},[t._v("#")]),t._v(" eventsMixin(Vue)")]),t._v(" "),s("p",[t._v("添加了")]),t._v(" "),s("ul",[s("li",[t._v("Vue.prototype.$on")]),t._v(" "),s("li",[t._v("Vue.prototype.$once")]),t._v(" "),s("li",[t._v("Vue.prototype.$off")]),t._v(" "),s("li",[t._v("Vue.prototype.$emit")])]),t._v(" "),s("h4",{attrs:{id:"on"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#on"}},[t._v("#")]),t._v(" $on")]),t._v(" "),s("p",[t._v("使用了发布-订阅模式，类似于node中的events模块,所有的event存在于vm._events中，结构如下:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("{\n  event1: [fn1, fn2...]\n  event2: []\n}\n")])])]),s("h3",{attrs:{id:"lifecyclemixin-vue"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lifecyclemixin-vue"}},[t._v("#")]),t._v(" lifecycleMixin(Vue)")]),t._v(" "),s("p",[t._v("添加了")]),t._v(" "),s("ul",[s("li",[t._v("Vue.prototype._update")]),t._v(" "),s("li",[t._v("Vue.prototype.$forceUpdate")]),t._v(" "),s("li",[t._v("Vue.prototype.$destroy")])]),t._v(" "),s("h3",{attrs:{id:"rendermixin-vue"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rendermixin-vue"}},[t._v("#")]),t._v(" renderMixin(Vue)")]),t._v(" "),s("p",[t._v("添加了")]),t._v(" "),s("ul",[s("li",[t._v("Vue.prototype.$nextTick")]),t._v(" "),s("li",[t._v("Vue.prototype._render")])]),t._v(" "),s("h2",{attrs:{id:"new-vue-的时候干了什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#new-vue-的时候干了什么"}},[t._v("#")]),t._v(" new Vue()的时候干了什么")]),t._v(" "),s("p",[t._v("执行了"),s("strong",[t._v("initMixin(Vue)"),s("strong",[t._v("中添加的")]),t._v("Vue.prototype._init")]),t._v("方法")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("_init")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("options"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Component "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// a uid， 全局唯一")]),t._v("\n    vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_uid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" uid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" startTag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" endTag\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* istanbul ignore if */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("performance "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" mark"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      startTag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("vue-perf-start:")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_uid"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n      endTag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("vue-perf-end:")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_uid"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mark")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("startTag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// a flag to avoid this being observed")]),t._v("\n    vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_isVue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// merge options")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_isComponent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// optimize internal component instantiation")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// since dynamic options merging is pretty slow, and none of the")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// internal component options needs special treatment.")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initInternalComponent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$options "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mergeOptions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolveConstructorOptions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("constructor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        options "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        vm\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* istanbul ignore else */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initProxy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_renderProxy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// expose real self")]),t._v("\n    vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_self "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initLifecycle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initEvents")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initRender")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("callHook")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'beforeCreate'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initInjections")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// resolve injections before data/props")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initProvide")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// resolve provide after data/props")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("callHook")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'created'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* istanbul ignore if */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("performance "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" mark"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("formatComponentName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mark")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("endTag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("measure")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("vue ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_name"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(" init")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" startTag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" endTag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$mount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("如上所示，主要做了下面的这些事情")]),t._v(" "),s("ol",[s("li",[t._v("添加一些属性 _uid, _isVue")]),t._v(" "),s("li",[t._v("merge options")]),t._v(" "),s("li",[t._v("初始化lifecycle")]),t._v(" "),s("li",[t._v("初始化events")]),t._v(" "),s("li",[t._v("初始化render")]),t._v(" "),s("li",[t._v("调用beforeCreate")]),t._v(" "),s("li",[t._v("初始化injections")]),t._v(" "),s("li",[t._v("初始化state")]),t._v(" "),s("li",[t._v("初始化provide")]),t._v(" "),s("li",[t._v("调用created")]),t._v(" "),s("li",[t._v("如果$el存在，则调用$mount($el)方法")])]),t._v(" "),s("h3",{attrs:{id:"初始化lifecycle"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化lifecycle"}},[t._v("#")]),t._v(" 初始化lifecycle")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("vm.$parent = parent\nvm.$root = parent ? parent.$root : vm\n\nvm.$children = []\nvm.$refs = {}\n\nvm._watcher = null\nvm._inactive = null\nvm._directInactive = false\nvm._isMounted = false\nvm._isDestroyed = false\nvm._isBeingDestroyed = false\n")])])]),s("h3",{attrs:{id:"初始化events"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化events"}},[t._v("#")]),t._v(" 初始化events")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("vm._events = Object.create(null)\nvm._hasHookEvent = false\n\n// init parent attached events\nconst listeners = vm.$options._parentListeners\nif (listeners) {\n  updateComponentListeners(vm, listeners)\n}\n")])])]),s("h3",{attrs:{id:"初始化render"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化render"}},[t._v("#")]),t._v(" 初始化render")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("vm.$slots = resolveSlots(options._renderChildren, renderContext)\nvm.$scopedSlots = emptyObject\n\n// bind the createElement fn to this instance\n// so that we get proper render context inside it.\n// args order: tag, data, children, normalizationType, alwaysNormalize\n// internal version is used by render functions compiled from templates\nvm._c = (a, b, c, d) => createElement(vm, a, b, c, d, false)\n\n// normalization is always applied for the public version, used in\n// user-written render functions.\nvm.$createElement = (a, b, c, d) => createElement(vm, a, b, c, d, true)\n\n\x3c!-- 响应式的定义了$attrs和$listeners --\x3e\ndefineReactive(vm, '$attrs', parentData && parentData.attrs || emptyObject, null, true)\ndefineReactive(vm, '$listeners', options._parentListeners || emptyObject, null, true)\n")])])]),s("h3",{attrs:{id:"调用beforecreate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调用beforecreate"}},[t._v("#")]),t._v(" 调用beforeCreate")]),t._v(" "),s("blockquote",[s("p",[t._v("这里才调用beforeCreate钩子\n此时有了events, $attrs,$listeners")])]),t._v(" "),s("h3",{attrs:{id:"初始化injections"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化injections"}},[t._v("#")]),t._v(" 初始化injections")]),t._v(" "),s("blockquote",[s("p",[t._v("resolve injections before data/props\n将"),s("strong",[t._v("inject")]),t._v("全部执行响应式操作"),s("strong",[t._v("defineReactive(vm, key, result[key])")])])]),t._v(" "),s("h3",{attrs:{id:"初始化state"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化state"}},[t._v("#")]),t._v(" 初始化state")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\nexport function initState (vm: Component) {\n  vm._watchers = []\n  const opts = vm.$options\n  if (opts.props) initProps(vm, opts.props)\n  if (opts.methods) initMethods(vm, opts.methods)\n  if (opts.data) {\n    initData(vm)\n  } else {\n    observe(vm._data = {}, true /* asRootData */)\n  }\n  if (opts.computed) initComputed(vm, opts.computed)\n  if (opts.watch && opts.watch !== nativeWatch) {\n    initWatch(vm, opts.watch)\n  }\n}\n")])])]),s("ol",[s("li",[t._v("初始化props   (initProps)")]),t._v(" "),s("li",[t._v("初始化methods (initMethods)")]),t._v(" "),s("li",[t._v("初始化data    (initData)")]),t._v(" "),s("li",[t._v("初始化计算属性 (initComputed)  "),s("strong",[t._v("vm._computedWatchers")])]),t._v(" "),s("li",[t._v("初始化watch   (initWatch)  "),s("strong",[t._v("vm.$watch(expOrFn, handler, options)")])])]),t._v(" "),s("h3",{attrs:{id:"初始化provide"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化provide"}},[t._v("#")]),t._v(" 初始化provide")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("export function initProvide (vm: Component) {\n  const provide = vm.$options.provide\n  if (provide) {\n    vm._provided = typeof provide === 'function'\n      ? provide.call(vm)\n      : provide\n  }\n}\n")])])]),s("p",[t._v("将provide中的对象存储到vm._provided中")]),t._v(" "),s("h3",{attrs:{id:"调用created"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调用created"}},[t._v("#")]),t._v(" 调用created")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("vm.$emit('hook:' + hook)\n")])])]),s("h3",{attrs:{id:"如果-el存在-则调用-mount-el-方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如果-el存在-则调用-mount-el-方法"}},[t._v("#")]),t._v(" 如果$el存在，则调用$mount($el)方法")]),t._v(" "),s("ol",[s("li",[t._v("callHook(vm, 'beforeMount')")]),t._v(" "),s("li",[t._v("vm._update()")]),t._v(" "),s("li")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(" new Watcher(vm, updateComponent, noop, {\n    before () {\n      if (vm._isMounted && !vm._isDestroyed) {\n        callHook(vm, 'beforeUpdate')\n      }\n    }\n  }, true /* isRenderWatcher */)\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("callHook(vm, 'mounted')")])])])}),[],!1,null,null,null);n.default=e.exports}}]);