<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>electron间的通信 | Adroi媒体API 接口文档</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="Adroi">
    <link rel="preload" href="/vuepress/assets/css/0.styles.7e3681cf.css" as="style"><link rel="preload" href="/vuepress/assets/js/app.42e791cd.js" as="script"><link rel="preload" href="/vuepress/assets/js/2.504a4fb4.js" as="script"><link rel="preload" href="/vuepress/assets/js/26.b1311701.js" as="script"><link rel="prefetch" href="/vuepress/assets/js/10.1b6255b7.js"><link rel="prefetch" href="/vuepress/assets/js/100.0c5fa987.js"><link rel="prefetch" href="/vuepress/assets/js/101.1eb9317d.js"><link rel="prefetch" href="/vuepress/assets/js/102.b48e208a.js"><link rel="prefetch" href="/vuepress/assets/js/103.0aa3b706.js"><link rel="prefetch" href="/vuepress/assets/js/104.d251d7f5.js"><link rel="prefetch" href="/vuepress/assets/js/105.cd6dba15.js"><link rel="prefetch" href="/vuepress/assets/js/106.186e3196.js"><link rel="prefetch" href="/vuepress/assets/js/107.85380677.js"><link rel="prefetch" href="/vuepress/assets/js/108.fa28ddbb.js"><link rel="prefetch" href="/vuepress/assets/js/109.229876f8.js"><link rel="prefetch" href="/vuepress/assets/js/11.0c3d3867.js"><link rel="prefetch" href="/vuepress/assets/js/110.55b2e189.js"><link rel="prefetch" href="/vuepress/assets/js/111.007bbae5.js"><link rel="prefetch" href="/vuepress/assets/js/112.a593fb61.js"><link rel="prefetch" href="/vuepress/assets/js/113.b17754cb.js"><link rel="prefetch" href="/vuepress/assets/js/114.2088808f.js"><link rel="prefetch" href="/vuepress/assets/js/115.4484de48.js"><link rel="prefetch" href="/vuepress/assets/js/116.b1161fb4.js"><link rel="prefetch" href="/vuepress/assets/js/12.2bba70fd.js"><link rel="prefetch" href="/vuepress/assets/js/13.1e86720b.js"><link rel="prefetch" href="/vuepress/assets/js/14.c4532bd0.js"><link rel="prefetch" href="/vuepress/assets/js/15.3d7b8604.js"><link rel="prefetch" href="/vuepress/assets/js/16.8d5363ca.js"><link rel="prefetch" href="/vuepress/assets/js/17.5ea8b68c.js"><link rel="prefetch" href="/vuepress/assets/js/18.15a00c2c.js"><link rel="prefetch" href="/vuepress/assets/js/19.400d107c.js"><link rel="prefetch" href="/vuepress/assets/js/20.6dd0518c.js"><link rel="prefetch" href="/vuepress/assets/js/21.b93d7e26.js"><link rel="prefetch" href="/vuepress/assets/js/22.4fe4c933.js"><link rel="prefetch" href="/vuepress/assets/js/23.3b59a0e7.js"><link rel="prefetch" href="/vuepress/assets/js/24.68de2ffd.js"><link rel="prefetch" href="/vuepress/assets/js/25.3379eb36.js"><link rel="prefetch" href="/vuepress/assets/js/27.55a99945.js"><link rel="prefetch" href="/vuepress/assets/js/28.8c827302.js"><link rel="prefetch" href="/vuepress/assets/js/29.2b03dd80.js"><link rel="prefetch" href="/vuepress/assets/js/3.b9c82753.js"><link rel="prefetch" href="/vuepress/assets/js/30.caf4564d.js"><link rel="prefetch" href="/vuepress/assets/js/31.91ada845.js"><link rel="prefetch" href="/vuepress/assets/js/32.1b1e0812.js"><link rel="prefetch" href="/vuepress/assets/js/33.51a97676.js"><link rel="prefetch" href="/vuepress/assets/js/34.7fb53727.js"><link rel="prefetch" href="/vuepress/assets/js/35.4aeb595b.js"><link rel="prefetch" href="/vuepress/assets/js/36.635c9ad3.js"><link rel="prefetch" href="/vuepress/assets/js/37.869edce2.js"><link rel="prefetch" href="/vuepress/assets/js/38.88074815.js"><link rel="prefetch" href="/vuepress/assets/js/39.fead8194.js"><link rel="prefetch" href="/vuepress/assets/js/4.5ed19beb.js"><link rel="prefetch" href="/vuepress/assets/js/40.cc3106e0.js"><link rel="prefetch" href="/vuepress/assets/js/41.38da2a4a.js"><link rel="prefetch" href="/vuepress/assets/js/42.bb47998b.js"><link rel="prefetch" href="/vuepress/assets/js/43.daa8c09a.js"><link rel="prefetch" href="/vuepress/assets/js/44.ab2cb9f6.js"><link rel="prefetch" href="/vuepress/assets/js/45.ff0a2c0c.js"><link rel="prefetch" href="/vuepress/assets/js/46.65fbf932.js"><link rel="prefetch" href="/vuepress/assets/js/47.9fd2ae18.js"><link rel="prefetch" href="/vuepress/assets/js/48.0899e6ef.js"><link rel="prefetch" href="/vuepress/assets/js/49.34f98028.js"><link rel="prefetch" href="/vuepress/assets/js/5.5ec666cd.js"><link rel="prefetch" href="/vuepress/assets/js/50.f76be82b.js"><link rel="prefetch" href="/vuepress/assets/js/51.dfa8eb85.js"><link rel="prefetch" href="/vuepress/assets/js/52.62244689.js"><link rel="prefetch" href="/vuepress/assets/js/53.a84abf39.js"><link rel="prefetch" href="/vuepress/assets/js/54.40598503.js"><link rel="prefetch" href="/vuepress/assets/js/55.d7d295f7.js"><link rel="prefetch" href="/vuepress/assets/js/56.79b96bd6.js"><link rel="prefetch" href="/vuepress/assets/js/57.257943ce.js"><link rel="prefetch" href="/vuepress/assets/js/58.dbc43307.js"><link rel="prefetch" href="/vuepress/assets/js/59.ba3e78c7.js"><link rel="prefetch" href="/vuepress/assets/js/6.9ce9e8d4.js"><link rel="prefetch" href="/vuepress/assets/js/60.5f63129b.js"><link rel="prefetch" href="/vuepress/assets/js/61.0f29bb79.js"><link rel="prefetch" href="/vuepress/assets/js/62.4f1507d8.js"><link rel="prefetch" href="/vuepress/assets/js/63.577cca8a.js"><link rel="prefetch" href="/vuepress/assets/js/64.0eaac1fb.js"><link rel="prefetch" href="/vuepress/assets/js/65.17cdae7d.js"><link rel="prefetch" href="/vuepress/assets/js/66.5e52701a.js"><link rel="prefetch" href="/vuepress/assets/js/67.8cdc875e.js"><link rel="prefetch" href="/vuepress/assets/js/68.acb0e5d0.js"><link rel="prefetch" href="/vuepress/assets/js/69.dd2fc3f6.js"><link rel="prefetch" href="/vuepress/assets/js/7.3918ea00.js"><link rel="prefetch" href="/vuepress/assets/js/70.a9b83eed.js"><link rel="prefetch" href="/vuepress/assets/js/71.07676ad4.js"><link rel="prefetch" href="/vuepress/assets/js/72.d65d254c.js"><link rel="prefetch" href="/vuepress/assets/js/73.d491d0fa.js"><link rel="prefetch" href="/vuepress/assets/js/74.b3f7f198.js"><link rel="prefetch" href="/vuepress/assets/js/75.1908418c.js"><link rel="prefetch" href="/vuepress/assets/js/76.8863ec98.js"><link rel="prefetch" href="/vuepress/assets/js/77.2af4230c.js"><link rel="prefetch" href="/vuepress/assets/js/78.573e5c6b.js"><link rel="prefetch" href="/vuepress/assets/js/79.addb464f.js"><link rel="prefetch" href="/vuepress/assets/js/8.d030b9c0.js"><link rel="prefetch" href="/vuepress/assets/js/80.50e664bf.js"><link rel="prefetch" href="/vuepress/assets/js/81.a5e616ec.js"><link rel="prefetch" href="/vuepress/assets/js/82.e96fb4c0.js"><link rel="prefetch" href="/vuepress/assets/js/83.0d44b591.js"><link rel="prefetch" href="/vuepress/assets/js/84.cb5ca3e7.js"><link rel="prefetch" href="/vuepress/assets/js/85.b347651a.js"><link rel="prefetch" href="/vuepress/assets/js/86.3549791d.js"><link rel="prefetch" href="/vuepress/assets/js/87.713e3b60.js"><link rel="prefetch" href="/vuepress/assets/js/88.d24c1bab.js"><link rel="prefetch" href="/vuepress/assets/js/89.58bfcdbf.js"><link rel="prefetch" href="/vuepress/assets/js/9.852048f0.js"><link rel="prefetch" href="/vuepress/assets/js/90.4da986d3.js"><link rel="prefetch" href="/vuepress/assets/js/91.076ab478.js"><link rel="prefetch" href="/vuepress/assets/js/92.65e80259.js"><link rel="prefetch" href="/vuepress/assets/js/93.6cb8f216.js"><link rel="prefetch" href="/vuepress/assets/js/94.c50f8a50.js"><link rel="prefetch" href="/vuepress/assets/js/95.d1fde022.js"><link rel="prefetch" href="/vuepress/assets/js/96.8358cfc2.js"><link rel="prefetch" href="/vuepress/assets/js/97.a795a595.js"><link rel="prefetch" href="/vuepress/assets/js/98.9c69f854.js"><link rel="prefetch" href="/vuepress/assets/js/99.6a00b884.js">
    <link rel="stylesheet" href="/vuepress/assets/css/0.styles.7e3681cf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress/" class="home-link router-link-active"><!----> <span class="site-name">Adroi媒体API 接口文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress/apiword.html" class="nav-link">
  接口定义
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress/apiword.html" class="nav-link">
  接口定义
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>chart</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>electron</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress/electron/electron学习笔记.html" class="sidebar-link">electron学习笔记</a></li><li><a href="/vuepress/electron/electron间的通信.html" class="active sidebar-link">electron间的通信</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>other</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="示意图"><a href="#示意图" class="header-anchor">#</a> 示意图</h3> <h3 id="主进程和子进程间的通信"><a href="#主进程和子进程间的通信" class="header-anchor">#</a> 主进程和子进程间的通信</h3> <h4 id="渲染进程-主进程-利用-ipcmain-ipcrenderer和-webcontents-send"><a href="#渲染进程-主进程-利用-ipcmain-ipcrenderer和-webcontents-send" class="header-anchor">#</a> 渲染进程----&gt;主进程(利用 ipcMain, ipcRenderer和 webContents.send)</h4> <h5 id="渲染进程"><a href="#渲染进程" class="header-anchor">#</a> 渲染进程：</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>ipcRenderer<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'custom-event'</span><span class="token punctuation">,</span> <span class="token string">'I am renderer process'</span><span class="token punctuation">)</span>
</code></pre></div><h5 id="主进程"><a href="#主进程" class="header-anchor">#</a> 主进程</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>ipcMain<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'custom-event'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>sender<span class="token punctuation">}</span><span class="token punctuation">,</span> args</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'reply'</span><span class="token punctuation">,</span> <span class="token string">'我收到了'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div> <h4 id="主进程-渲染进程"><a href="#主进程-渲染进程" class="header-anchor">#</a> 主进程----&gt;渲染进程</h4> <h5 id="主进程-2"><a href="#主进程-2" class="header-anchor">#</a> 主进程</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 主进程.main.js</span>
<span class="token keyword">var</span> mainWindow <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	mainWindow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mainWindow<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span><span class="token string">'file://'</span> <span class="token operator">+</span> __dirname <span class="token operator">+</span> <span class="token string">'/index.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mainWindow<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'did-finish-load'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mainWindow<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'ping'</span><span class="token punctuation">,</span> <span class="token string">'whoooooooh!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h6 id="渲染进程-2"><a href="#渲染进程-2" class="header-anchor">#</a> 渲染进程</h6> <div class="language-js extra-class"><pre class="language-js"><code>	<span class="token keyword">const</span> <span class="token punctuation">{</span>ipcRenderer<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
  ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ping'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>sender<span class="token punctuation">,</span> args<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p><strong>注意</strong>，<code>webContents.on</code> 监听的是已经定义好的事件，如上面的 <code>did-finish-load</code>。要监听自定义的事件还是通过 <code>ipcMain</code> 和 <code>ipcRenderer</code>。</p></blockquote> <h4 id="渲染进程-a-和-渲染进程-b之间的通信"><a href="#渲染进程-a-和-渲染进程-b之间的通信" class="header-anchor">#</a> 渲染进程 A 和 渲染进程 B之间的通信</h4> <p>通过主进程 mainProcess作为中转站，转发事件</p> <h4 id="利用-electron-remote-模块进行通信"><a href="#利用-electron-remote-模块进行通信" class="header-anchor">#</a> 利用 electron.remote 模块进行通信</h4> <p>在渲染进程中，可以通过</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> remote <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>获取到 <code>remote</code> 对象，通过 <code>remote</code> 对象可以让渲染进程访问/使用主进程的模块。例如，通过 <code>remote</code> 在渲染进程中新建一个窗口：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> BrowserWindow <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>remote
  <span class="token keyword">let</span> win <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>width<span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  win<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span><span class="token string">'https://github.com'</span><span class="token punctuation">)</span>
</code></pre></div><p>同样的，我们也可以通过 <code>remote</code> 对象访问到 <code>app</code> 对象。这样我们就可以访问到我们在主进程中挂载到 <code>electron.app</code> 对象上的方法。</p> <p>如：</p> <p><code>main.js</code> 文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// In main process</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span>utils <span class="token operator">=</span> utils<span class="token punctuation">;</span> <span class="token comment">// 将在 Electron 层实现的接口绑定到 app 上</span>
</code></pre></div><p><code>index.js</code> 文件(被网页引用的脚本文件)：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> remote <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// In renderer process</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// remote.app.utils 对象与上述文件中的 utils 对象是一样的。</span>
    remote<span class="token punctuation">.</span>app<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="electron-的两种进程通信方法是如何实现的"><a href="#electron-的两种进程通信方法是如何实现的" class="header-anchor">#</a> Electron 的两种进程通信方法是如何实现的？</h3> <p>知道怎么用还不够，还需要了解 Electron 是如何实现这两种通信方法的，以及 Electron 为什么要实现两种通信方法，这两种通信方法的有什么不同的地方。弄清楚这些开发起来才会对程序的数据流比较清晰。</p> <h4 id="ipcmain-和-ipcrenderer"><a href="#ipcmain-和-ipcrenderer" class="header-anchor">#</a> <code>ipcMain</code> 和 <code>ipcRenderer</code></h4> <blockquote><p>The ipcMain module is an instance of the EventEmitter class. When used in the main process, it handles asynchronous and synchronous messages sent from a renderer process (web page). Messages sent from a renderer will be emitted to this module.</p></blockquote> <p><code>ipcMain</code> 和 <code>ipcRenderer</code> 都是 <code>EventEmitter</code> 类的一个实例。而 <code>EventEmitter</code> 类由 NodeJS 中的 <a href="https://nodejs.org/api/events.html" target="_blank" rel="noopener noreferrer">events<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 模块导出。</p> <h4 id="events-eventemitter"><a href="#events-eventemitter" class="header-anchor">#</a> <code>events.EventEmitter</code></h4> <p><code>EventEmitter</code> 类是 NodeJS 事件的基础，实现了事件模型需要的接口， 包括 <code>addListener</code>，<code>removeListener</code>, <code>emit</code> 及其它工具方法. 同原生 <code>JavaScript</code> 事件类似， 采用了发布/订阅(观察者)的方式， 使用内部 <code>_events</code> 列表来记录注册的事件处理器。</p> <p>我们通过 <code>ipcMain</code>和<code>ipcRenderer</code> 的 <code>on</code>、<code>send</code> 进行监听和发送消息都是 <code>EventEmitter</code> 定义的相关接口。</p> <p>那么 ipcMain 和 ipcRenderer 是如何实现这些接口的呢？</p> <h4 id="ipc-renderer-js"><a href="#ipc-renderer-js" class="header-anchor">#</a> ipc-renderer.js</h4> <p><a href="https://github.com/electron/electron/blob/master/lib/renderer/api/ipc-renderer.js" target="_blank" rel="noopener noreferrer">ipc-renderer.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：</p> <div class="language- extra-class"><pre class="language-text"><code>const binding = process.atomBinding('ipc')

...

// Created by init.js.
const ipcRenderer = v8Util.getHiddenValue(global, 'ipc')

ipcRenderer.send = function (...args) {
  return binding.send('ipc-message', args)
}

....

module.exports = ipcRenderer
</code></pre></div><p>调用了 <code>atomBinding('ipc')</code> 得到的 <code>binding</code> 对象的 <code>send</code> 方法。后面 <code>binding.send</code> 应该就是 IPC 相关的实现了：对传送的数据进行序列化和反序列化。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 主进程</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'test1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span><span class="token function-variable function">toJSON</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'call toJSON'</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span>returnValue <span class="token operator">=</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'test2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'123'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span>returnValue <span class="token operator">=</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 渲染进程</span>
<span class="token keyword">let</span> returnValue <span class="token operator">=</span> ipcRenderer<span class="token punctuation">.</span><span class="token function">sendSync</span><span class="token punctuation">(</span><span class="token string">'test1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> returnValue<span class="token punctuation">,</span> returnValue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'string call toJSON'</span>

returnValue <span class="token operator">=</span> ipcRenderer<span class="token punctuation">.</span><span class="token function">sendSync</span><span class="token punctuation">(</span><span class="token string">'test2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> returnValue<span class="token punctuation">,</span> returnValue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'object Object name: &quot;123&quot;__proto__: Object'</span>
</code></pre></div><p>从渲染进程输出的消息可以看到，主进程将返回值调用 <code>toJSON</code> 后传递给渲染进程。渲染进程再对传输过来的内容进行反序列化。</p> <h4 id="remote-远程对象"><a href="#remote-远程对象" class="header-anchor">#</a> <code>remote</code> 远程对象</h4> <p>通过 <code>remote</code> 对象，我们可以不必发送进程间消息来进行通信。但实际上，我们在调用远程对象的方法、函数或者通过远程构造函数创建一个新的对象，实际上都是在发送一个同步的进程间消息（<a href="https://electronjs.org/docs/api/remote#remote" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 上说这类似于 JAVA 中的 <a href="https://en.wikipedia.org/wiki/Java_remote_method_invocation" target="_blank" rel="noopener noreferrer">RMI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</p> <p>也就是说，<code>remote</code> 方法只是不用让我们显式的写发送进程间的消息的方法而已。在上面通过 <code>remote</code> 模块创建 <code>BrowserWindow</code> 的例子里。我们在渲染进程中创建的 <code>BrowserWindow</code> 对象其实并不在我们的渲染进程中，它只是让主进程创建了一个 <code>BrowserWindow</code> 对象，并返回了这个相对应的远程对象给了渲染进程。</p> <blockquote><p>摘自 https://imweb.io/topic/5b13a663d4c96b9b1b4c4e9c</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepress/electron/electron学习笔记.html" class="prev">
        electron学习笔记
      </a></span> <span class="next"><a href="/vuepress/git/git-reset的基本操作.html">
        git-reset的基本操作
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress/assets/js/app.42e791cd.js" defer></script><script src="/vuepress/assets/js/2.504a4fb4.js" defer></script><script src="/vuepress/assets/js/26.b1311701.js" defer></script>
  </body>
</html>
