<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>http访问控制 | Adroi媒体API 接口文档</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="Adroi">
    <link rel="preload" href="/assets/css/0.styles.7950d16d.css" as="style"><link rel="preload" href="/assets/js/app.a8f039a7.js" as="script"><link rel="preload" href="/assets/js/2.b233f276.js" as="script"><link rel="preload" href="/assets/js/75.1cdcb0c8.js" as="script"><link rel="prefetch" href="/assets/js/10.45b68d43.js"><link rel="prefetch" href="/assets/js/100.a2bf971c.js"><link rel="prefetch" href="/assets/js/101.6bfd7c76.js"><link rel="prefetch" href="/assets/js/102.976aec73.js"><link rel="prefetch" href="/assets/js/103.f9dda5bb.js"><link rel="prefetch" href="/assets/js/104.7a2c044c.js"><link rel="prefetch" href="/assets/js/105.254fc915.js"><link rel="prefetch" href="/assets/js/106.f41915af.js"><link rel="prefetch" href="/assets/js/107.a66fa4f8.js"><link rel="prefetch" href="/assets/js/108.9b6c69dc.js"><link rel="prefetch" href="/assets/js/109.f1614e55.js"><link rel="prefetch" href="/assets/js/11.1d47dcc9.js"><link rel="prefetch" href="/assets/js/110.48b16839.js"><link rel="prefetch" href="/assets/js/111.d4a62b82.js"><link rel="prefetch" href="/assets/js/112.a5d6d308.js"><link rel="prefetch" href="/assets/js/113.5676d524.js"><link rel="prefetch" href="/assets/js/114.35a64e8e.js"><link rel="prefetch" href="/assets/js/115.4eb6bffb.js"><link rel="prefetch" href="/assets/js/116.36f3e1e4.js"><link rel="prefetch" href="/assets/js/117.6de94982.js"><link rel="prefetch" href="/assets/js/12.bed0e105.js"><link rel="prefetch" href="/assets/js/13.0a5eac21.js"><link rel="prefetch" href="/assets/js/14.7bfc5893.js"><link rel="prefetch" href="/assets/js/15.06f779a9.js"><link rel="prefetch" href="/assets/js/16.9fb99a2c.js"><link rel="prefetch" href="/assets/js/17.89c79110.js"><link rel="prefetch" href="/assets/js/18.48846e09.js"><link rel="prefetch" href="/assets/js/19.d166835e.js"><link rel="prefetch" href="/assets/js/20.c42b4af5.js"><link rel="prefetch" href="/assets/js/21.c826a5fe.js"><link rel="prefetch" href="/assets/js/22.f7c5eb29.js"><link rel="prefetch" href="/assets/js/23.2a8387c7.js"><link rel="prefetch" href="/assets/js/24.1c8761a8.js"><link rel="prefetch" href="/assets/js/25.df9afda7.js"><link rel="prefetch" href="/assets/js/26.254a37a7.js"><link rel="prefetch" href="/assets/js/27.763eb91e.js"><link rel="prefetch" href="/assets/js/28.5fde24ce.js"><link rel="prefetch" href="/assets/js/29.3194dc2b.js"><link rel="prefetch" href="/assets/js/3.9af03473.js"><link rel="prefetch" href="/assets/js/30.adf415e7.js"><link rel="prefetch" href="/assets/js/31.0d9487fa.js"><link rel="prefetch" href="/assets/js/32.b09a0d09.js"><link rel="prefetch" href="/assets/js/33.ac311d11.js"><link rel="prefetch" href="/assets/js/34.0f57c1f7.js"><link rel="prefetch" href="/assets/js/35.fc139df6.js"><link rel="prefetch" href="/assets/js/36.cd5e93dc.js"><link rel="prefetch" href="/assets/js/37.92b4ef45.js"><link rel="prefetch" href="/assets/js/38.200d8d29.js"><link rel="prefetch" href="/assets/js/39.49215cf6.js"><link rel="prefetch" href="/assets/js/4.5ed19beb.js"><link rel="prefetch" href="/assets/js/40.d967755e.js"><link rel="prefetch" href="/assets/js/41.3d11424b.js"><link rel="prefetch" href="/assets/js/42.ddb02fd2.js"><link rel="prefetch" href="/assets/js/43.72451ce4.js"><link rel="prefetch" href="/assets/js/44.dda78bfd.js"><link rel="prefetch" href="/assets/js/45.5b7bcf15.js"><link rel="prefetch" href="/assets/js/46.e8267815.js"><link rel="prefetch" href="/assets/js/47.a31ff353.js"><link rel="prefetch" href="/assets/js/48.72d2784b.js"><link rel="prefetch" href="/assets/js/49.2f5bc428.js"><link rel="prefetch" href="/assets/js/5.f5c0ce10.js"><link rel="prefetch" href="/assets/js/50.034785a8.js"><link rel="prefetch" href="/assets/js/51.175ebded.js"><link rel="prefetch" href="/assets/js/52.03ba2ff7.js"><link rel="prefetch" href="/assets/js/53.5242c91c.js"><link rel="prefetch" href="/assets/js/54.ca3f953a.js"><link rel="prefetch" href="/assets/js/55.1a5c5c9f.js"><link rel="prefetch" href="/assets/js/56.4d18a0bc.js"><link rel="prefetch" href="/assets/js/57.7cf39605.js"><link rel="prefetch" href="/assets/js/58.05f13011.js"><link rel="prefetch" href="/assets/js/59.911c3751.js"><link rel="prefetch" href="/assets/js/6.b4a5dcc0.js"><link rel="prefetch" href="/assets/js/60.b4a8a69b.js"><link rel="prefetch" href="/assets/js/61.bc7b4786.js"><link rel="prefetch" href="/assets/js/62.0884aba5.js"><link rel="prefetch" href="/assets/js/63.3a4807c0.js"><link rel="prefetch" href="/assets/js/64.a73cbe1c.js"><link rel="prefetch" href="/assets/js/65.9ce55b96.js"><link rel="prefetch" href="/assets/js/66.63299762.js"><link rel="prefetch" href="/assets/js/67.24873c55.js"><link rel="prefetch" href="/assets/js/68.e25a440a.js"><link rel="prefetch" href="/assets/js/69.2b08dddd.js"><link rel="prefetch" href="/assets/js/7.7026210c.js"><link rel="prefetch" href="/assets/js/70.36069df9.js"><link rel="prefetch" href="/assets/js/71.020da373.js"><link rel="prefetch" href="/assets/js/72.be9a4443.js"><link rel="prefetch" href="/assets/js/73.39a6064f.js"><link rel="prefetch" href="/assets/js/74.4594d1a5.js"><link rel="prefetch" href="/assets/js/76.0195b2cc.js"><link rel="prefetch" href="/assets/js/77.615e5834.js"><link rel="prefetch" href="/assets/js/78.d7db8490.js"><link rel="prefetch" href="/assets/js/79.f3d6c5a0.js"><link rel="prefetch" href="/assets/js/8.bb748099.js"><link rel="prefetch" href="/assets/js/80.c4f67a4b.js"><link rel="prefetch" href="/assets/js/81.d51cedf7.js"><link rel="prefetch" href="/assets/js/82.3f27cee9.js"><link rel="prefetch" href="/assets/js/83.89df6e98.js"><link rel="prefetch" href="/assets/js/84.258ae313.js"><link rel="prefetch" href="/assets/js/85.69d467bd.js"><link rel="prefetch" href="/assets/js/86.cee6ae45.js"><link rel="prefetch" href="/assets/js/87.a2512d98.js"><link rel="prefetch" href="/assets/js/88.e33945a6.js"><link rel="prefetch" href="/assets/js/89.ac3d4c85.js"><link rel="prefetch" href="/assets/js/9.6341ef08.js"><link rel="prefetch" href="/assets/js/90.31bd1ef5.js"><link rel="prefetch" href="/assets/js/91.60f3687a.js"><link rel="prefetch" href="/assets/js/92.cb37f837.js"><link rel="prefetch" href="/assets/js/93.903d1935.js"><link rel="prefetch" href="/assets/js/94.59089737.js"><link rel="prefetch" href="/assets/js/95.4a6d7e03.js"><link rel="prefetch" href="/assets/js/96.1f626ad6.js"><link rel="prefetch" href="/assets/js/97.7b9a3517.js"><link rel="prefetch" href="/assets/js/98.00872dff.js"><link rel="prefetch" href="/assets/js/99.38d137f2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7950d16d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Adroi媒体API 接口文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/apiword.html" class="nav-link">
  接口定义
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/apiword.html" class="nav-link">
  接口定义
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>chart</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>other</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/other/amd-cmd-commonjs和es6的简单对比.html" class="sidebar-link">amd/cmd/commonjs和es6的简单对比</a></li><li><a href="/other/codemirror基本配置.html" class="sidebar-link">codemirror基本配置</a></li><li><a href="/other/hexo中嵌入codepen.html" class="sidebar-link">hexo中嵌入codepen</a></li><li><a href="/other/hexo博客图片问题解决方案.html" class="sidebar-link">hexo博客图片问题解决方案</a></li><li><a href="/other/http缓存.html" class="sidebar-link">HTTP缓存机制</a></li><li><a href="/other/http访问控制.html" class="active sidebar-link">http访问控制</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/other/iphone中的一些兼容问题.html" class="sidebar-link">iphone中的一些兼容问题</a></li><li><a href="/other/npm常用知识点.html" class="sidebar-link">npm常用知识点</a></li><li><a href="/other/post和get的区别.html" class="sidebar-link">post和get的区别</a></li><li><a href="/other/proxy体验.html" class="sidebar-link">proxy体验</a></li><li><a href="/other/typora编写markdown.html" class="sidebar-link">typora编写markdown</a></li><li><a href="/other/ubuntu16-04更新源.html" class="sidebar-link">ubuntu16.04更新源</a></li><li><a href="/other/从url到页面渲染的流程.html" class="sidebar-link">从url到页面渲染的流程</a></li><li><a href="/other/前端性能监控.html" class="sidebar-link">前端性能监控</a></li><li><a href="/other/如何为网站接入百度统计.html" class="sidebar-link">如何为网站接入百度统计</a></li><li><a href="/other/如何搭建hexo博客.html" class="sidebar-link">如何搭建hexo博客</a></li><li><a href="/other/浏览器页面渲染过程.html" class="sidebar-link">浏览器页面渲染过程</a></li><li><a href="/other/深度优先遍历和广度优先遍历.html" class="sidebar-link">深度优先遍历和广度优先遍历</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="http访问控制-cors-概念"><a href="#http访问控制-cors-概念" class="header-anchor">#</a> http访问控制(cors)概念</h3> <div class="language- extra-class"><pre><code>跨域资源共享(CORS) 是一种机制，它使用额外的 HTTP 头来告诉浏览器  让运行在一个 origin (domain) 上的Web应用被准许访问来自不同源服务器上的指定的资源。
</code></pre></div><p>出于安全原因，浏览器限制从脚本内<strong>发起</strong>的跨源HTTP请求。</p> <blockquote><p>⚠️不一定是浏览器限制了发起跨站请求，也可能是跨站请求可以正常发起，但是返回结果被浏览器拦截了</p></blockquote> <h3 id="简单请求-满足下面所有条件"><a href="#简单请求-满足下面所有条件" class="header-anchor">#</a> 简单请求: (满足下面所有条件)</h3> <p>方法：GET、HEAD、POST
Content-Typ为下面三个值之一：text/plain 、mutipart/form-data 、application/x-www-data-urlencoded</p> <h3 id="复杂请求【预检请求】-满足下面任一条件"><a href="#复杂请求【预检请求】-满足下面任一条件" class="header-anchor">#</a> 复杂请求【预检请求】（满足下面任一条件）</h3> <p>与前述简单请求不同，“需预检的请求”要求必须首先使用 OPTIONS 方法发起一个预检请求到服务器，以获知服务器是否允许该实际请求。&quot;预检请求“的使用，可以避免跨域请求对服务器的用户数据产生未预期的影响。	
当请求满足下述任一条件时，即应首先发送预检请求：</p> <ul><li>使用了下面任一 HTTP 方法：</li></ul> <ol><li>PUT</li> <li>DELETE</li> <li>CONNECT</li> <li>OPTIONS</li> <li>TRACE</li> <li>PATCH</li></ol> <ul><li>人为设置了对 CORS 安全的首部字段集合之外的其他首部字段。该集合为：</li></ul> <ol><li>Accept</li> <li>Accept-Language</li> <li>Content-Language</li> <li>Content-Type (需要注意额外的限制)</li></ol> <ul><li>Content-Type 的值不属于下列之一:</li></ul> <ol><li>application/x-www-form-urlencoded</li> <li>multipart/form-data</li> <li>text/plain</li></ol> <ul><li>请求中的XMLHttpRequestUpload 对象注册了任意多个事件监听器。</li> <li>请求中使用了ReadableStream对象。</li></ul> <h3 id="http响应首部字段"><a href="#http响应首部字段" class="header-anchor">#</a> HTTP响应首部字段：</h3> <h4 id="access-control-allow-origin"><a href="#access-control-allow-origin" class="header-anchor">#</a> Access-Control-Allow-Origin</h4> <h4 id="access-control-expose-headers"><a href="#access-control-expose-headers" class="header-anchor">#</a> Access-Control-Expose-Headers</h4> <p>让服务器把允许浏览器访问的头放入白名单。在跨域访问时，XMLHttpRequest对象的getResponseHeader()方法只能拿到一些最基本的响应头，Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma，如果要访问其他头，则需要服务器设置本响应头。</p> <h4 id="access-control-max-age"><a href="#access-control-max-age" class="header-anchor">#</a> Access-Control-Max-Age</h4> <p>指定了preflight请求的结果能够被缓存多久</p> <h4 id="access-control-allow-credentials"><a href="#access-control-allow-credentials" class="header-anchor">#</a> Access-Control-Allow-Credentials</h4> <p>指定了当浏览器的credentials设置为true时是否允许浏览器读取response的内容。当用在对preflight预检测请求的响应中时，它指定了实际的请求是否可以使用credentials。请注意：简单 GET 请求不会被预检；如果对此类请求的响应中不包含该字段，这个响应将被忽略掉，并且浏览器也不会将相应内容返回给网页</p> <h4 id="access-control-allow-methods"><a href="#access-control-allow-methods" class="header-anchor">#</a> Access-Control-Allow-Methods</h4> <p>首部字段用于预检请求的响应。其指明了实际请求所允许使用的 HTTP 方法</p> <h4 id="access-control-allow-headers"><a href="#access-control-allow-headers" class="header-anchor">#</a> Access-Control-Allow-Headers</h4> <p>首部字段用于预检请求的响应。其指明了实际请求中允许携带的首部字段。</p> <h3 id="http请求首部字段"><a href="#http请求首部字段" class="header-anchor">#</a> HTTP请求首部字段：</h3> <h4 id="origin-首部字段表明预检请求或实际请求的源站。"><a href="#origin-首部字段表明预检请求或实际请求的源站。" class="header-anchor">#</a> Origin 首部字段表明预检请求或实际请求的源站。</h4> <p>它不包含任何路径信息，只是服务器名称。Note: 有时候将该字段的值设置为空字符串是有用的，例如，当源站是一个 data URL 时。</p> <h4 id="access-control-request-method"><a href="#access-control-request-method" class="header-anchor">#</a> Access-Control-Request-Method</h4> <p>首部字段用于预检请求。其作用是，将实际请求所使用的 HTTP 方法告诉服务器。</p> <h4 id="access-control-request-headers"><a href="#access-control-request-headers" class="header-anchor">#</a> Access-Control-Request-Headers</h4> <p>首部字段用于预检请求。其作用是，将实际请求所携带的首部字段告诉服务器。</p> <p>摘录自https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS</p> <h3 id="最后来一个小demo吧"><a href="#最后来一个小demo吧" class="header-anchor">#</a> 最后来一个小demo吧</h3> <p>index1.html</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
  &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  port: 9000 index page
  &lt;!-- &lt;script src=&quot;http://127.0.0.1:9001/&quot;&gt;&lt;/script&gt; --&gt;
  &lt;script&gt;
    var xhr = new XMLHttpRequest()
    xhr.open('put', 'http://127.0.0.1:9001/')
    // xhr.setRequestHeader('X-Custom-Field', 'custom-field')
    xhr.send()
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>server1.js</p> <div class="language- extra-class"><pre class="language-text"><code>const http = require('http');
const fs = require('fs')

http.createServer(function(req, res) {
  if(req.url === '/') {
    file = fs.readFileSync('./index1.html', 'utf-8')
    res.writeHead(200, {
      'Content-Type': 'text/html'
    })
    res.end(file)
  }
}).listen(9000, '127.0.0.1')
</code></pre></div><p>server2.js</p> <div class="language- extra-class"><pre class="language-text"><code>const http = require('http');

// http.createServer(function(req, res) {
//   if(req.url === '/') {
//     console.log('come in 127.0.0.1:9001 server')
//     res.writeHead(200,{
//       'Content-Type': 'text/plain'
//     })
//     res.end('9001 index page')
//   }
// }).listen(9001, '127.0.0.1')


// http.createServer(function(req, res) {
//   if(req.url === '/') {
//     console.log('come in 127.0.0.1:9001 server')
//     res.writeHead(200,{
//       'Access-Control-Allow-Origin': '*', // 告诉浏览器允许访问的origin
//       'Content-Type': 'text/plain' 
//     })
//     res.end('9001 index page')
//   }
// }).listen(9001, '127.0.0.1')



http.createServer(function(req, res) {
  if(req.url === '/') {
    console.log('come in 127.0.0.1:9001 server')
    res.writeHead(200,{
      'Access-Control-Allow-Origin': '*', // 告诉浏览器允许访问的origin
      'Access-Control-Allow-Methods': 'PUT', 
      'Allow-Control-Request-Method': 'PUT',
      // 'Access-Control-Allow-Headers': 'X-Custom-Field',  // 用来指定允许的自定义header
      // 'Access-Control-Max-Age': 0,   //指定预请求(prefight)的有效期， 单位为秒
      // 'Cache-Control': 'no-store',
      'Content-Type': 'text/plain'
    })
    res.end(JSON.stringify({
      name: 'Tom'
    }))
  }
}).listen(9001, '127.0.0.1')
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/other/http缓存.html" class="prev">
        HTTP缓存机制
      </a></span> <span class="next"><a href="/other/iphone中的一些兼容问题.html">
        iphone中的一些兼容问题
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a8f039a7.js" defer></script><script src="/assets/js/2.b233f276.js" defer></script><script src="/assets/js/75.1cdcb0c8.js" defer></script>
  </body>
</html>
