<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>readyState和DomContentLoaded的先后顺序 | Adroi媒体API 接口文档</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="Adroi">
    <link rel="preload" href="/vuepress/assets/css/0.styles.7e3681cf.css" as="style"><link rel="preload" href="/vuepress/assets/js/app.4c3d8c08.js" as="script"><link rel="preload" href="/vuepress/assets/js/2.504a4fb4.js" as="script"><link rel="preload" href="/vuepress/assets/js/45.ff0a2c0c.js" as="script"><link rel="prefetch" href="/vuepress/assets/js/10.2e1f457a.js"><link rel="prefetch" href="/vuepress/assets/js/100.69be1aac.js"><link rel="prefetch" href="/vuepress/assets/js/101.f2d9c3ba.js"><link rel="prefetch" href="/vuepress/assets/js/102.dab86b6c.js"><link rel="prefetch" href="/vuepress/assets/js/103.f6d48b6b.js"><link rel="prefetch" href="/vuepress/assets/js/104.3af59700.js"><link rel="prefetch" href="/vuepress/assets/js/105.cd6dba15.js"><link rel="prefetch" href="/vuepress/assets/js/106.2780f302.js"><link rel="prefetch" href="/vuepress/assets/js/107.718538b4.js"><link rel="prefetch" href="/vuepress/assets/js/108.05c6fd5d.js"><link rel="prefetch" href="/vuepress/assets/js/109.6e4d0078.js"><link rel="prefetch" href="/vuepress/assets/js/11.0c3d3867.js"><link rel="prefetch" href="/vuepress/assets/js/110.55b2e189.js"><link rel="prefetch" href="/vuepress/assets/js/111.bbd33e6f.js"><link rel="prefetch" href="/vuepress/assets/js/112.1b1418a2.js"><link rel="prefetch" href="/vuepress/assets/js/113.5d225fe2.js"><link rel="prefetch" href="/vuepress/assets/js/114.62231e84.js"><link rel="prefetch" href="/vuepress/assets/js/115.4484de48.js"><link rel="prefetch" href="/vuepress/assets/js/116.b1161fb4.js"><link rel="prefetch" href="/vuepress/assets/js/12.05410804.js"><link rel="prefetch" href="/vuepress/assets/js/13.c257f5fd.js"><link rel="prefetch" href="/vuepress/assets/js/14.24f97a2a.js"><link rel="prefetch" href="/vuepress/assets/js/15.90d51633.js"><link rel="prefetch" href="/vuepress/assets/js/16.793ee9a7.js"><link rel="prefetch" href="/vuepress/assets/js/17.f16cfc36.js"><link rel="prefetch" href="/vuepress/assets/js/18.15a00c2c.js"><link rel="prefetch" href="/vuepress/assets/js/19.acf47267.js"><link rel="prefetch" href="/vuepress/assets/js/20.6c38a1d1.js"><link rel="prefetch" href="/vuepress/assets/js/21.b212c78d.js"><link rel="prefetch" href="/vuepress/assets/js/22.cb7f5f64.js"><link rel="prefetch" href="/vuepress/assets/js/23.c5af75e5.js"><link rel="prefetch" href="/vuepress/assets/js/24.68de2ffd.js"><link rel="prefetch" href="/vuepress/assets/js/25.3379eb36.js"><link rel="prefetch" href="/vuepress/assets/js/26.03f0f7bd.js"><link rel="prefetch" href="/vuepress/assets/js/27.afd99cce.js"><link rel="prefetch" href="/vuepress/assets/js/28.8c827302.js"><link rel="prefetch" href="/vuepress/assets/js/29.2b03dd80.js"><link rel="prefetch" href="/vuepress/assets/js/3.b9c82753.js"><link rel="prefetch" href="/vuepress/assets/js/30.caf4564d.js"><link rel="prefetch" href="/vuepress/assets/js/31.91ada845.js"><link rel="prefetch" href="/vuepress/assets/js/32.23cb9536.js"><link rel="prefetch" href="/vuepress/assets/js/33.4124b074.js"><link rel="prefetch" href="/vuepress/assets/js/34.7fb53727.js"><link rel="prefetch" href="/vuepress/assets/js/35.4aeb595b.js"><link rel="prefetch" href="/vuepress/assets/js/36.635c9ad3.js"><link rel="prefetch" href="/vuepress/assets/js/37.869edce2.js"><link rel="prefetch" href="/vuepress/assets/js/38.009324ba.js"><link rel="prefetch" href="/vuepress/assets/js/39.fcf46ae3.js"><link rel="prefetch" href="/vuepress/assets/js/4.5ed19beb.js"><link rel="prefetch" href="/vuepress/assets/js/40.cc3106e0.js"><link rel="prefetch" href="/vuepress/assets/js/41.38da2a4a.js"><link rel="prefetch" href="/vuepress/assets/js/42.bb47998b.js"><link rel="prefetch" href="/vuepress/assets/js/43.daa8c09a.js"><link rel="prefetch" href="/vuepress/assets/js/44.ab2cb9f6.js"><link rel="prefetch" href="/vuepress/assets/js/46.65fbf932.js"><link rel="prefetch" href="/vuepress/assets/js/47.9fd2ae18.js"><link rel="prefetch" href="/vuepress/assets/js/48.0899e6ef.js"><link rel="prefetch" href="/vuepress/assets/js/49.34f98028.js"><link rel="prefetch" href="/vuepress/assets/js/5.5ec666cd.js"><link rel="prefetch" href="/vuepress/assets/js/50.f76be82b.js"><link rel="prefetch" href="/vuepress/assets/js/51.3d23a5c2.js"><link rel="prefetch" href="/vuepress/assets/js/52.7248379e.js"><link rel="prefetch" href="/vuepress/assets/js/53.de24ee86.js"><link rel="prefetch" href="/vuepress/assets/js/54.65b89acf.js"><link rel="prefetch" href="/vuepress/assets/js/55.9f39dfd4.js"><link rel="prefetch" href="/vuepress/assets/js/56.79b96bd6.js"><link rel="prefetch" href="/vuepress/assets/js/57.257943ce.js"><link rel="prefetch" href="/vuepress/assets/js/58.dbc43307.js"><link rel="prefetch" href="/vuepress/assets/js/59.ba3e78c7.js"><link rel="prefetch" href="/vuepress/assets/js/6.9c419b6f.js"><link rel="prefetch" href="/vuepress/assets/js/60.f6cb3f45.js"><link rel="prefetch" href="/vuepress/assets/js/61.8fccbe6b.js"><link rel="prefetch" href="/vuepress/assets/js/62.876ce530.js"><link rel="prefetch" href="/vuepress/assets/js/63.d09b9ba9.js"><link rel="prefetch" href="/vuepress/assets/js/64.7ae4c720.js"><link rel="prefetch" href="/vuepress/assets/js/65.dcb24d90.js"><link rel="prefetch" href="/vuepress/assets/js/66.25fee310.js"><link rel="prefetch" href="/vuepress/assets/js/67.363f95f8.js"><link rel="prefetch" href="/vuepress/assets/js/68.d10a4837.js"><link rel="prefetch" href="/vuepress/assets/js/69.dfa76a7a.js"><link rel="prefetch" href="/vuepress/assets/js/7.867b2329.js"><link rel="prefetch" href="/vuepress/assets/js/70.e232d8eb.js"><link rel="prefetch" href="/vuepress/assets/js/71.5472e87d.js"><link rel="prefetch" href="/vuepress/assets/js/72.86c24205.js"><link rel="prefetch" href="/vuepress/assets/js/73.d491d0fa.js"><link rel="prefetch" href="/vuepress/assets/js/74.b3f7f198.js"><link rel="prefetch" href="/vuepress/assets/js/75.04dec8a8.js"><link rel="prefetch" href="/vuepress/assets/js/76.3f863c0e.js"><link rel="prefetch" href="/vuepress/assets/js/77.2af4230c.js"><link rel="prefetch" href="/vuepress/assets/js/78.8e477d1e.js"><link rel="prefetch" href="/vuepress/assets/js/79.bb6d8069.js"><link rel="prefetch" href="/vuepress/assets/js/8.7d3eea64.js"><link rel="prefetch" href="/vuepress/assets/js/80.50e664bf.js"><link rel="prefetch" href="/vuepress/assets/js/81.1eb919e8.js"><link rel="prefetch" href="/vuepress/assets/js/82.23f7096a.js"><link rel="prefetch" href="/vuepress/assets/js/83.d4e00f8f.js"><link rel="prefetch" href="/vuepress/assets/js/84.161eff9e.js"><link rel="prefetch" href="/vuepress/assets/js/85.b8895c91.js"><link rel="prefetch" href="/vuepress/assets/js/86.fece9d59.js"><link rel="prefetch" href="/vuepress/assets/js/87.713e3b60.js"><link rel="prefetch" href="/vuepress/assets/js/88.d24c1bab.js"><link rel="prefetch" href="/vuepress/assets/js/89.9cfc7c2e.js"><link rel="prefetch" href="/vuepress/assets/js/9.995dc946.js"><link rel="prefetch" href="/vuepress/assets/js/90.204c89d9.js"><link rel="prefetch" href="/vuepress/assets/js/91.076ab478.js"><link rel="prefetch" href="/vuepress/assets/js/92.65e80259.js"><link rel="prefetch" href="/vuepress/assets/js/93.6cb8f216.js"><link rel="prefetch" href="/vuepress/assets/js/94.7e57d8f6.js"><link rel="prefetch" href="/vuepress/assets/js/95.c40c0fdb.js"><link rel="prefetch" href="/vuepress/assets/js/96.18c67a13.js"><link rel="prefetch" href="/vuepress/assets/js/97.2881347c.js"><link rel="prefetch" href="/vuepress/assets/js/98.e8257a88.js"><link rel="prefetch" href="/vuepress/assets/js/99.cd60c379.js">
    <link rel="stylesheet" href="/vuepress/assets/css/0.styles.7e3681cf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress/" class="home-link router-link-active"><!----> <span class="site-name">Adroi媒体API 接口文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress/apiword.html" class="nav-link">
  接口定义
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress/apiword.html" class="nav-link">
  接口定义
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>chart</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>js</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress/js/dataTable中自定义列排序问题.html" class="sidebar-link">dataTable中自定义列排序问题</a></li><li><a href="/vuepress/js/js-jquery判断是否包含类.html" class="sidebar-link">js/jquery判断是否包含类</a></li><li><a href="/vuepress/js/js中函数的参数传递误区.html" class="sidebar-link">js中函数的参数传递误区</a></li><li><a href="/vuepress/js/js中对象的delete.html" class="sidebar-link">js中对象的delete</a></li><li><a href="/vuepress/js/js中的this机制.html" class="sidebar-link">js中的this机制</a></li><li><a href="/vuepress/js/js原型.html" class="sidebar-link">js的封装和继承</a></li><li><a href="/vuepress/js/js基本类型和引用类型.html" class="sidebar-link">变量、作用域和内存问题</a></li><li><a href="/vuepress/js/js的事件模型.html" class="sidebar-link">js的事件模型</a></li><li><a href="/vuepress/js/js的几种模块化方式.html" class="sidebar-link">js的几种模块化方式</a></li><li><a href="/vuepress/js/js的有趣应用.html" class="sidebar-link">js的有趣应用</a></li><li><a href="/vuepress/js/js的灵活.html" class="sidebar-link">js的灵活</a></li><li><a href="/vuepress/js/js自定义modal框.html" class="sidebar-link">js自定义modal框</a></li><li><a href="/vuepress/js/list转成tree型数据结构.html" class="sidebar-link">list转成tree型数据结构</a></li><li><a href="/vuepress/js/macrotask和microtask以及eventloop的介绍.html" class="sidebar-link">macrotask和microtask以及eventloop的介绍</a></li><li><a href="/vuepress/js/readyState和DomContentLoaded的先后顺序.html" class="active sidebar-link">readyState和DomContentLoaded的先后顺序</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress/js/reduce函数的应用.html" class="sidebar-link">reduce函数的应用</a></li><li><a href="/vuepress/js/repalce函数的应用.html" class="sidebar-link">repalce函数的应用</a></li><li><a href="/vuepress/js/stopImmediatePropagation和stopPropagation的区别.html" class="sidebar-link">stopImmediatePropagation和stopPropagation的区别</a></li><li><a href="/vuepress/js/stringify的使用.html" class="sidebar-link">stringify的使用</a></li><li><a href="/vuepress/js/video基本知识点.html" class="sidebar-link">video基本知识点</a></li><li><a href="/vuepress/js/判断类型的方式.html" class="sidebar-link">判断类型的方式</a></li><li><a href="/vuepress/js/前端的常用转换操作.html" class="sidebar-link">前端的常用转换操作</a></li><li><a href="/vuepress/js/将数组扁平化并去除其中重复数据，最终得到一个升序且不重复的数组.html" class="sidebar-link">将数组扁平化并去除其中重复数据，最终得到一个升序且不重复的数组</a></li><li><a href="/vuepress/js/执行栈和执行上下文.html" class="sidebar-link">执行栈和执行上下文</a></li><li><a href="/vuepress/js/模拟一些常见的js函数.html" class="sidebar-link">模拟一些常见的js函数</a></li><li><a href="/vuepress/js/比较两个值相等.html" class="sidebar-link">比较两个值相等</a></li><li><a href="/vuepress/js/深拷贝.html" class="sidebar-link">深拷贝</a></li><li><a href="/vuepress/js/监听快捷键.html" class="sidebar-link">监听快捷键</a></li><li><a href="/vuepress/js/移动端iphone点击返回时强制页面刷新解决办法.html" class="sidebar-link">移动端iphone点击返回时强制页面刷新解决办法</a></li><li><a href="/vuepress/js/移动端判断横竖屏的兼容性写法.html" class="sidebar-link">移动端判断横竖屏的兼容性写法</a></li><li><a href="/vuepress/js/类型转换.html" class="sidebar-link">类型转换</a></li><li><a href="/vuepress/js/缓存memorize.html" class="sidebar-link">缓存memorize</a></li><li><a href="/vuepress/js/自增version的脚本.html" class="sidebar-link">自增version的脚本</a></li><li><a href="/vuepress/js/节流和防抖.html" class="sidebar-link">节流和防抖</a></li><li><a href="/vuepress/js/装箱和拆箱.html" class="sidebar-link">装箱和拆箱</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>other</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="快速了解document-readystate"><a href="#快速了解document-readystate" class="header-anchor">#</a> 快速了解document.readyState</h3> <p>document.readyState是一个只读属性，可以返回当前文档的准备状态。</p> <p>语法
var state = document.readyState;
其中state值包含下面三个值：</p> <h4 id="loading"><a href="#loading" class="header-anchor">#</a> loading</h4> <p>表示文档正在加载中。</p> <h4 id="interactive"><a href="#interactive" class="header-anchor">#</a> interactive</h4> <p>表示文档已完成加载，文档已被解析，但图像、样式表和框架等子资源仍在加载。</p> <h4 id="complete"><a href="#complete" class="header-anchor">#</a> complete</h4> <p>表示文档和所有子资源已完成加载。如果状态变成这个，表明load事件即将触发。
document.readyState是一个IE7，IE8浏览器也支持的很古老的属性，设计的初衷是好的，看起来也会是一个非常有用的属性，但是实际上我敢保证，对于绝大多数的前端开发人员，肯定没有在实际项目中用过这个属性。</p> <p>包括我自己，在很长一段时间以内，都认为这个属性中看不中用，连个锤子用都没有。</p> <p>为什么呢？</p> <p>原因有两个：一是没必要；二是有更好的选择。</p> <h3 id="dom事件绑定没必要等domready"><a href="#dom事件绑定没必要等domready" class="header-anchor">#</a> DOM事件绑定没必要等domready</h3> <p>对于web页面开发，JavaScript最主要的功能之一就是页面上DOM元素的交互实现，如果DOM元素还没有加载也没有被解析，自然这些DOM操作难以为继。于是，JS初始化的时机就变得很重要。</p> <p>实际上，如果我们的JS文件以及script代码都放在页面的<strong>底部</strong>，我们不用考虑JS初始化时机，因为JS放在底部，等到要执行的时候，上面DOM都已经解析好了，百分之一亿可以放心运行。也就是什么readyState，什么DOMContentLoaded都不需要考虑。</p> <p>我们经常会看到下面的代码：</p> <div class="language- extra-class"><pre class="language-text"><code>$(document).ready(function() {
    // 少年的你，代码写在这里...
});
</code></pre></div><p>我会立即马上把$(document).ready这一戳东西删掉，只要你的JS代码是在页面底部的，这些都完全不需要，放心删除，绝对不会有任何问题，直接下面这样就好了：</p> <div class="language- extra-class"><pre class="language-text"><code>(function() {
    // zhangxinxu: 这里代码...
})();
</code></pre></div><p>执行时机更快。</p> <p>结合现状
几乎所有的网页性能分析工具都会把JS文件放在底部作为考察项之一，JS放在底部已经算是网页开发常事之一了。很多萌新可能不知道，在10年前，绝大多数网页的JavaScript引用都是在<strong>head</strong>中的，所以那个时期，有大量的文章探讨文档的加载机制，JS的执行时间等等问题。</p> <p>随着一年一年的进步，现在这样的现象已经不多了，大家习惯都比较好，遇不到问题，自然探讨的就少了，探讨的少了，很多开发人员就不知道这样的事情，也就自然不会用了，毕竟，还有大把的新技术新框架要去学习呢。</p> <p>这就是document.readyState以及'readystatechange'事件现在出现比较少的原因。</p> <p>附上实际开发'readystatechange'事件使用示例：</p> <div class="language- extra-class"><pre class="language-text"><code>document.onreadystatechange = function () {
    // document.readyState发生变化的时候执行
}
</code></pre></div><h3 id="domcontentloaded事件"><a href="#domcontentloaded事件" class="header-anchor">#</a> DOMContentLoaded事件</h3> <p>document.readyState越来越少用到的另外一个原因，就是半路上杀出一个程咬金——'DOMContentLoaded'事件。</p> <p>DOMContentLoaded事件是DOM Level 3新增的一个事件类型，IE9+浏览器支持，表示DOM节点内容加载完毕。</p> <div class="language- extra-class"><pre class="language-text"><code>document.addEventListener('DOMContentLoaded', function () {});
或者：

window.addEventListener('DOMContentLoaded', function () {});
</code></pre></div><p>DOMContentLoaded设计初衷就是为了方便JS代码的初始化，要比记得记不住的interactive状态容易理解，也
容易使用的多。</p> <p>因此，如果为了提防我们的JavaScript代码不小心跑到了页面的顶部，需要确保在DOM加载完毕之后执行，推荐使用下面代码：</p> <div class="language- extra-class"><pre class="language-text"><code>window.addEventListener('DOMContentLoaded', function () {
    // https://www.zhangxinxu.com/wordpress/?p=9032代码这里...
});
</code></pre></div><p>由于script元素本身也是DOM元素，因此，只要脚本不是异步加载的，无论放在页面什么位置，DOMContentLoaded事件一定会触发。</p> <p>我们不妨来看一个例子，了解更多关于DOMContentLoaded事件触发更多细节。</p> <p>假设有一个名为 insert.js 的文件，里面的JS代码如下：</p> <div class="language- extra-class"><pre class="language-text"><code>console.log('zxx被加载了~' + document.readyState);
window.addEventListener('DOMContentLoaded', function () {
    console.log('CSS选择器这本书很赞哦！' + document.readyState);
});
</code></pre></div><p>然后还有一个名为load-test.html的页面，里面代码这样：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;body&gt;
&lt;script src=&quot;./insert.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
</code></pre></div><p>结果页面进入，控制台出现了下图所示的结果：</p> <p>控制台输出结果截图</p> <p>可以看到，&quot;DOMContentLoaded&quot;事件绑定时候文档状态是'loading'，执行的时候文档状态是可交互的'interactive'。</p> <p>配合其他测试（这里不展示），我们可以得出一个网页文档几个加载状态变化和事件触发顺序是这样子的：</p> <div class="language- extra-class"><pre class="language-text"><code>document.readyState = 'loading'
↓
document.readyState变成'interactive'
↓
'DOMContentLoaded'事件执行
↓
document.readyState变成'complete'
↓
'load'事件执行
</code></pre></div><p>以及可以推测出一个结论：</p> <p>DOMContentLoaded事件必须在文档状态为loading时候绑定才有效。</p> <p>正是由于上面推论，才使得document.readyState有了应用场景。</p> <h3 id="需要用到document-readystate的场景"><a href="#需要用到document-readystate的场景" class="header-anchor">#</a> 需要用到document.readyState的场景</h3> <p>由于DOMContentLoaded事件绑定后可能并不会执行，于是出现了需要用到document.readyState的场景。</p> <p>什么时候DOMContentLoaded事件不会执行呢？</p> <p>那就是相关脚本是在页面DOM加载完毕后执行的场景下。</p> <p>眼见为实，我们看例子：</p> <p>假设有一个名为 insert.js 的文件，里面的JS代码如下：</p> <div class="language- extra-class"><pre class="language-text"><code>console.log('zxx被加载了~' + document.readyState);
window.addEventListener(&quot;DOMContentLoaded&quot;, function () {
    console.log('CSS选择器这本书很赞哦！');
});
</code></pre></div><p>然后还有一个名为load-test.html的页面，里面代码这样：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;body&gt;
  &lt;script&gt;
    var eleScript = document.createElement('script');
    eleScript.src = './insert.js';
    document.head.appendChild(eleScript);
  &lt;/script&gt;
&lt;/body&gt;
</code></pre></div><p>结果页面进入，控制台只有'zxx被加载了~'的文案，并没有DOMContentLoaded事件中的console.log输出，如下图所示：</p> <p>因为DOMContentLoaded事件绑定的时候，页面的准备状态已经是'interactive'而不是'loading'了。</p> <p>如果insert.js是一个公用组件，尤其以后会开源的那种，那势必要考虑到各种加载场景，页面的头部，页面底部，或者异步动态加载，此时，单纯靠DOMContentLoaded事件只能覆盖前两种情况，异步动态加载无能为力。</p> <p>此时，一直认为没什么锤子用的document.readyState倒是排上了用场，假设组件的初始方法名为init，则好的实现方法是这样的：</p> <div class="language- extra-class"><pre class="language-text"><code>if (document.readyState != 'loading') {
    init();
} else {
    window.addEventListener(&quot;DOMContentLoaded&quot;, function () {
        init();
    });
}
</code></pre></div><p>这是当下实际开发中，唯一需要使用document.readyState的场景，在开源或者大规模使用的框架或组件中精准初始化使用。</p> <h3 id="load-readstate-domcontentloaded-pageshow执行的先后顺序"><a href="#load-readstate-domcontentloaded-pageshow执行的先后顺序" class="header-anchor">#</a> load/readState/DomContentLoaded/pageshow执行的先后顺序</h3> <p><img src="/readyState%E5%92%8CDomContentLoaded%E7%9A%84%E5%85%88%E5%90%8E%E9%A1%BA%E5%BA%8F/image-20200824110347927.png" alt="image-20200824110347927"></p> <blockquote><p>摘自 https://www.zhangxinxu.com/wordpress/2019/10/document-readystate/</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepress/js/macrotask和microtask以及eventloop的介绍.html" class="prev">
        macrotask和microtask以及eventloop的介绍
      </a></span> <span class="next"><a href="/vuepress/js/reduce函数的应用.html">
        reduce函数的应用
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress/assets/js/app.4c3d8c08.js" defer></script><script src="/vuepress/assets/js/2.504a4fb4.js" defer></script><script src="/vuepress/assets/js/45.ff0a2c0c.js" defer></script>
  </body>
</html>
